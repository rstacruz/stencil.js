<script src='vendor/jquery.js'></script>
<script src='vendor/underscore.js'></script>
<script src='vendor/backbone.js'></script>
<script src='stencil.js'></script>
<div id='post'>
  <h2>x</h2>
  <input type='text' />
  <div class='body'>
    <p>x</p>
  </div>
</div>
<div id="articles">
  <article>
    <h3>-</h3>
    <div class="s body">-</div>
  </article>
</div>

<script>
  Article = Backbone.Model.extend({
    initialize: function() {
    }
  });

  ArticleView = Backbone.View.extend({
    bindings: {
      'change:title': {
        'h2': function() { return this.get('title'); },
        '@class': function() { return this.get('title') + 'x'; },
        'input@value': function() { return this.get('title') + '!'; },
        'p': function() { return this.get('title') + "..."; }
      }
    },
    initialize: function(options) {
      this.model = options.model;
      this.binding = this.$el.listenTo(this.model, this.bindings).run('change:*');
    }
  });

  Articles = Backbone.Collection.extend({
    model: Article
  });

  var a = new Article({ title: "Foobar", body: "Well hello there" });
  var view = new ArticleView({ model: a, el: $("#post") });
  window.setTimeout(function() { a.set({ title: "Yay" }); }, 500);
  window.setTimeout(function() { a.set({ title: "Boo" }); }, 1000);
  window.setTimeout(function() { view.$('h2').html('hey'); }, 1500);


  var arts = new Articles([ {title: 'x', body: 'y'}, {title: 'n', body: 'yes'} ]);
  $("#articles").stencil(arts, {
    'add': {
      '-> article': {
        '@data-id': function(person) { return person.cid; },
        'h3': function(person) { return person.get('title'); },
        '.s.body': function(person) { return person.get('body'); }
      }
    },
    'remove': {
      '<- article @data-id': function(person) { return person.cid; }
    }
  });

  arts.add([{ title: 'Miles Davis', body: 'Hello' }, { title: 'Another', body: 'foo' }]);
  arts.add([{ title: 'Ella Fitz', body: 'yo' }, { title: 'Thelonius Monk', body: 'ya' }]);
  arts.add(a);
  arts.remove(a);
</script>

