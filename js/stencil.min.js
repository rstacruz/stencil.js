/*! Stencil.js templating/binding engine
https://github.com/rstacruz/stencil.js
*/(function(){var a,b,c,d=[].slice;c=0,a=function(a,b){return b.length?a.find(b):a},b=function(){function b(a,b,c){this.$el=a,c==null&&(c=b,b=null),this.model=b,this.events=this._flattenRules(c),this._memoize(this,"getSingleRunner"),this.bind()}return b.prototype._memoize=function(a,b){var d;return d=function(a,b,d){var e,f,g;return e=(g=(f=d[0]).uniq)!=null?g:f.uniq=c++,[a,b,e]},a[b]=_.memoize(a[b],d)},b.prototype.bind=function(){var a,b=this;if((a=this.model)!=null?a.on:void 0)this.unbind(),this.handlers={},_.each(this.events,function(a,c){return b.handlers[c]=function(){var a;return a=1<=arguments.length?d.call(arguments,0):[],b.run.apply(b,[c].concat(d.call(a)))},b.model.on(c,b.handlers[c])});return this},b.prototype.unbind=function(){var a,b=this;if((a=this.model)!=null?!a.off:!void 0)return;return this.handlers&&(_.each(this.handlers,function(a,c){return b.model.off(c,a)}),this.handlers=null),this},b.prototype._flattenRules=function(a){var b,c=this;return b={},_.each(a,function(a,c){var d;return d=c.split(/, */),_.each(d,function(c){var d;return(d=b[c])==null&&(b[c]={}),_.extend(b[c],a)})}),b},b.prototype.run=function(){var a,b;return b=arguments[0],a=2<=arguments.length?d.call(arguments,1):[],b==null&&(b="*"),b.indexOf("*")>-1?this.runGlob(b):(_.isArray(b)||(b=[b]),this.runDirectives(this.getDirectivesFor(b),a),this)},b.prototype.runDirectives=function(a,b,c){var d;return c==null&&(c=this.$el),d=this.getRunner(a,c),d(b)},b.prototype.getRunner=function(a,b){var c,d=this;return b==null&&(b=this.$el),c=_.map(a,function(a,c){return d.getSingleRunner(c,a,b)}),function(a){return _.each(c,function(b){return b(a)})}},b.prototype.getSingleRunner=function(a,b,c){var d,e,f,g;f=function(a,b){var c;if(!b)return[];c=a.match(b);if(!c)throw"Matcher error: '"+a+"'";return c},e=f(a,this.formats.selector),d=e[1],g=e[2];if(!this.runners[d])throw"Unknown action: '"+d+"'";return e=f(g,this.formats[d]),this.runners[d].apply(this,[g,b,c,e[1],e[2],e[3]])},b.prototype.formats={selector:/^\s*([^\s]+)\s*(.*?)\s*$/,add:/^(.*?)\s*>\s*([^>]+?)$/,attr:/^(.*?)\s*@([A-Za-z0-9\-\_]+)$/,remove:/^(.*?)\s*>\s*([^>]+?)\s*@([A-Za-z0-9\-\_]+)\s*$/},b.prototype.runners={"default":function(b,c,d,e){var f,g=this;return f=_.bind(c,this.model),function(c){var g;return g=f.apply(null,c),a(d,b)[e](g)}},html:function(a,b,c){return this.runners["default"].apply(this,[a,b,c,"html"])},text:function(a,b,c){return this.runners["default"].apply(this,[a,b,c,"text"])},attr:function(b,c,d,e,f){var g,h,i=this;return g=a(d,e),h=_.bind(c,this.model),function(a){return g.attr(f,h.apply(null,a))}},add:function(b,c,d,e,f){var g,h,i=this;return g=a(d,e),h=$(g.find(f)[0]).remove(),function(a){var b;return b=function(a){var b,d;return b=h.clone(),d=i.getRunner(c,b),d(a),g.append(b)},_.isArray(a[0])?_.each(a[0],function(a){return b([a])}):a[0].each?a[0].each(function(a){return b([a])}):b(a)}},remove:function(b,c,d,e,f,g){var h,i,j=this;return h=a(d,e),i=_.bind(c,this.model),function(b){var c;return c=i.apply(null,b),a(h,f).filter("["+g+'="'+c+'"]').remove()}}},b.prototype.runGlob=function(a){var b;return b=_.filter(_.keys(this.events),function(b){return b.match(new RegExp("^"+a.replace("*",".*")+"$"))}),this.run(b)},b.prototype.getDirectivesFor=function(a){var b,c=this;return _.isArray(a)||(a=[a]),b={},_.each(a,function(a){if(typeof c.events[a]=="object")return _.extend(b,c.events[a])}),b},b}(),$.fn.stencil=function(a,c){return new b(this,a,c)}}).call(this)